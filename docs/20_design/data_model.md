## 5.2 データ設計書

### 概要
システムで扱うデータの構造を定義するドキュメントです。データベース設計だけでなく、アプリケーション内で使用するデータ型も含みます。

**作成タイミング:**
- アーキテクチャ設計書の後
- インターフェース仕様書や機能詳細仕様書の前提となる

### 記載項目

#### 5.2.0 更新履歴
- **記載内容:** このドキュメントをだれがいつなにを更新したかを記述(CHANGELOG相当)

#### 5.2.1 概念データモデル
- **記載内容:** ビジネス視点でのデータ構造
- **エンティティ一覧:** システムで扱う主要な概念・対象物
- **ER図:** エンティティ間の関係性を図示
- **主要な属性:** 各エンティティの代表的な属性
- **カーディナリティ:** エンティティ間の関係の多重度（1:1, 1:N, N:M）
- **ビジネスルール:** データに関する業務ルール

#### 5.2.2 論理データモデル
- **記載内容:** 実装に近い形でのデータ構造
- 概念データモデルを正規化し、実装可能な形に変換
- **エンティティの詳細定義:**
  - エンティティ名（論理名）
  - すべての属性
  - 属性のデータ型（論理型）
  - 必須/任意の区別
  - 一意性制約
  - デフォルト値
- **関係の詳細:**
  - 外部キー
  - 参照整合性制約

#### 5.2.3 物理データモデル（データベース設計）
- **記載内容:** 実際のDBMSに実装するための設計
- **テーブル定義:** 各テーブルについて:
  - テーブル名（物理名）
  - テーブル名（論理名）
  - 説明
  - **カラム定義:** 各カラムについて:
    - カラム名（物理名）
    - カラム名（論理名）
    - データ型（物理型: VARCHAR(255), INT, TIMESTAMP等）
    - NULL可否
    - デフォルト値
    - 説明
  - **制約:**
    - 主キー（PRIMARY KEY）
    - 外部キー（FOREIGN KEY）
    - ユニーク制約（UNIQUE）
    - チェック制約（CHECK）
  - **インデックス:**
    - インデックス名
    - 対象カラム
    - インデックスの種類（B-tree, Hash等）
    - 作成理由（クエリ最適化のため）

#### 5.2.4 アプリケーションデータ型仕様
- **記載内容:** アプリケーション内で使用するデータ型の定義
- データベース以外でやり取りされるデータ構造
- **列挙型（Enum）:**
  - 型名
  - 取りうる値の一覧
  - 各値の説明
- **構造体 / クラス / インターフェース:**
  - 型名
  - プロパティ一覧
  - 各プロパティのデータ型
  - 必須/任意の区別
  - バリデーションルール
- **辞書型 / Map:**
  - キーの型
  - 値の型
  - 用途
- **配列 / リスト:**
  - 要素の型
  - サイズ制約

#### 5.2.5 データ制約とバリデーション
- **記載内容:** データの妥当性を保証するルール
- **値の範囲:** 最小値、最大値
- **文字列の制約:** 長さ、形式（正規表現）
- **日付の制約:** 過去/未来の制限、日付範囲
- **ビジネスルール:** 業務ロジックに基づく制約
- **相互依存:** 複数フィールド間の依存関係

#### 5.2.6 データマイグレーション
- **記載内容:** データベーススキーマの変更管理
- **マイグレーション方針:**
  - マイグレーションツールの選定
  - マイグレーションファイルの命名規則
  - バージョン管理の方法
- **ロールバック方針:** スキーマ変更を元に戻す手順
- **データ移行:** 既存データの移行が必要な場合の手順
