
## 5. 設計仕様書群

### 概要
要求仕様書で定義された要件を、実装可能な形に詳細化する一連のドキュメント群です。旧来の「機能仕様書」を、関心事ごとに分割し、段階的に作成できるようにしています。

**必要性:**
- 必須ドキュメント群
- 忘れた頃に自分が使うときにも、読めば使い方を改めて確認できる
- 顧客とも共有する

**作成順序:**
1. **アーキテクチャ設計書** - システムの骨格を定義
2. **データ設計書** - データ構造の基盤を確立
3. **インターフェース仕様書** と **機能詳細仕様書** - 並行して作成、相互参照
4. **ユースケース実装ガイド** - インターフェース仕様書と機能詳細仕様書の作成と並行
5. **品質・運用設計書** と **外部連携仕様書** - 各段階で必要になったときに順次記述

---

## 5.1 アーキテクチャ設計書

### 概要
システム全体の構造と技術構成を定義するドキュメントです。すべての設計仕様の基盤となります。

**作成タイミング:**
- 要求仕様書完成後、最初に作成
- データ設計書や他の設計仕様書の前提となる

### 記載項目

#### 5.1.0 更新履歴
- **記載内容:** このドキュメントをだれがいつなにを更新したかを記述(CHANGELOG相当)

#### 5.1.1 システム概要図
- **記載内容:** システム全体の構造を視覚化
- ブロック図でシステムの構成要素を表現(Markdown組み込みのmermaidを利用)
- 主要コンポーネント（フロントエンド、バックエンド、データベース、外部サービスなど）
- コンポーネント間の関係性
- 物理的な配置（サーバー構成、ネットワーク構成）

#### 5.1.2 アーキテクチャパターン
- **記載内容:** 採用するアーキテクチャの種類と理由
- **アーキテクチャの種類:** 
  - レイヤードアーキテクチャ、MVC、マイクロサービス、イベント駆動、クリーンアーキテクチャなど
- **選定理由:** なぜこのアーキテクチャを選んだか
- **構造図:** レイヤー構成やモジュール構成の図示

#### 5.1.3 アーキテクチャ決定記録（ADR）
- **記載内容:** 重要なアーキテクチャ上の決定事項
- 各決定について:
  - **決定ID:** 識別子（例: ADR-001）
  - **タイトル:** 決定の簡潔な表現
  - **状態:** 提案中/承認済み/却下/廃止
  - **コンテキスト:** 何が問題だったか、なぜ決定が必要だったか
  - **決定内容:** 何を決定したか（「〜する」という形式）
  - **理由:** なぜこの決定を下したか
  - **影響:** この決定による影響（正負両面）
  - **代替案:** 検討したが採用しなかった選択肢
  - **関連する決定:** 他のADRへの参照

例：
- レイヤー間の依存方向のルール
- データベースアクセスを許可するレイヤーの制限
- 外部APIアクセスのパターン

#### 5.1.4 設計指針
- **記載内容:** 開発全体で守るべきガイドライン
- ルールではなく推奨事項（強制力はADRより弱い）
- 採用している設計原則:
  - SOLID原則
  - DRY原則
  - 関心の分離
  - など
- コーディング規約への参照
- 命名規則の方針

#### 5.1.5 技術スタック
- **記載内容:** 使用する技術の一覧
- **プログラミング言語:** 言語とバージョン
- **フレームワーク:** 使用するフレームワークとバージョン
- **ライブラリ:** 主要なライブラリ
- **データベース:** DBMS の種類とバージョン
- **ミドルウェア:** メッセージキュー、キャッシュサーバーなど
- **インフラ:** クラウドサービス、コンテナ技術、オーケストレーションツール
- **開発ツール:** ビルドツール、CI/CDツール、バージョン管理
- **選定理由:** 各技術を選んだ理由（簡潔に）

#### 5.1.6 非同期・並行処理設計
- **記載内容:** 非同期処理や並行処理の全体方針
- **非同期処理の方針:**
  - どのような処理を非同期にするか（方針レベル）
  - 非同期処理の実現方式（メッセージキュー、バックグラウンドジョブ、イベント駆動など）
- **並行制御の方針:**
  - 並行・並列処理が発生する箇所の特定
  - Race condition対策の基本方針
  - 排他制御の方法（ロック戦略、トランザクション分離レベルなど）
- **イベント駆動アーキテクチャの場合:**
  - イベントフロー全体図
  - イベントの種類と分類
  - イベントバスの設計
- **整合性の方針:** 
  - 最終的整合性 vs 強整合性の使い分け
  - データ整合性を保証する仕組み

※個別機能の詳細は機能詳細仕様書に記載